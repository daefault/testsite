<!-- templates/cinema/admin_dashboard.html -->
{% extends 'main/base.html' %}
{% load static %}

{% block title %}Админ-панель - Кинотеатр "Экран"{% endblock %}

{% block content %}
<h1 class="mb-4"><i class="bi bi-speedometer2"></i> Админ-панель</h1>

<!-- Статистика -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h2>{{ stats.total_movies }}</h2>
                <p class="mb-0">Фильмов</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h2>{{ stats.total_sessions }}</h2>
                <p class="mb-0">Сеансов</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-warning text-dark">
            <div class="card-body text-center">
                <h2>{{ stats.total_tickets }}</h2>
                <p class="mb-0">Билетов</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <h2>{{ stats.total_users }}</h2>
                <p class="mb-0">Пользователей</p>
            </div>
        </div>
    </div>
</div>

<!-- Быстрые действия -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">Быстрые действия</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 mb-3">
                <a href="{% url 'admin:cinema_movie_add' %}" class="btn btn-primary w-100">
                    <i class="bi bi-plus-circle"></i> Добавить фильм
                </a>
            </div>
            <div class="col-md-3 mb-3">
                <a href="{% url 'admin:cinema_session_add' %}" class="btn btn-success w-100">
                    <i class="bi bi-plus-circle"></i> Добавить сеанс
                </a>
            </div>
            <div class="col-md-3 mb-3">
                <a href="{% url 'admin:cinema_cinemahall_add' %}" class="btn btn-warning w-100">
                    <i class="bi bi-plus-circle"></i> Добавить зал
                </a>
            </div>
            <div class="col-md-3 mb-3">
                <a href="{% url 'admin:index' %}" class="btn btn-dark w-100">
                    <i class="bi bi-gear"></i> Django Admin
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Последние билеты -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Последние покупки</h5>
    </div>
    <div class="card-body">
        {% if recent_tickets %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Фильм</th>
                        <th>Пользователь</th>
                        <th>Дата сеанса</th>
                        <th>Место</th>
                        <th>Цена</th>
                        <th>Статус</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ticket in recent_tickets %}
                    <tr>
                        <td>#{{ ticket.id }}</td>
                        <td>{{ ticket.session.movie.name|truncatechars:30 }}</td>
                        <td>
                            {% if ticket.client %}
                                {{ ticket.client.username }}
                            {% else %}
                                Гость
                            {% endif %}
                        </td>
                        <td>{{ ticket.session.date_session }} {{ ticket.session.start_time|time:"H:i" }}</td>
                        <td>Ряд {{ ticket.seat.row }}, Место {{ ticket.seat.seat_in_row }}</td>
                        <td class="text-success">{{ ticket.session.price }} ₽</td>
                        <td>
                            <span class="badge {% if ticket.status %}bg-success{% else %}bg-warning{% endif %}">
                                {% if ticket.status %}Продан{% else %}Забронирован{% endif %}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            Покупок пока нет
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}